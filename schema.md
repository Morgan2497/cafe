// Firebase schema using Cloud Firestore (NoSQL)

// Collection: users
{
  id: String, 
  name: String,
  email: String, // Unique
  phone: String,
  // Password handled by Firebase Authentication
  role: String, // 'customer', 'admin', 'manager'
  createdAt: Timestamp,
  updatedAt: Timestamp
}

// Collection: products
{
  id: String, 
  name: String,
  description: String,
  price: Number,
  stock: Number,
  categoryId: String, 
  brandId: String,
  },
  sizeOptions: [
    {
      id: String, // e.g., "small", "medium", "large"
      name: String, // Display name, e.g. "Small", "Medium", "Large"
      volume: String, // e.g., "1 quart", "5 quart", "1 gallon"
      price: Number, // Price specific to this size
      inStock: Boolean // Stock status for this specific size
    }
  ],
  images: [
    {
      storagePath: String, // Path to image in Firebase Storage (gs://cpsc-449-project.firebasestorage.app/product_images/image_name.jpg)
      alt: String,
      isPrimary: Boolean
    }
  ],
  isActive: Boolean,
  createdAt: Timestamp,
  updatedAt: Timestamp
}

// Collection: brands
{
  id: String, 
  name: String,
  description: String,
  logo: String, // Storage path to logo image in Firebase Storage (gs://cpsc-449-project.firebasestorage.app/brand_logos/logo_name.jpg)
  featured: Boolean,
  createdAt: Timestamp,
  updatedAt: Timestamp
}

// Collection: categories
{
  id: String, 
  name: String,
  description: String,
  createdAt: Timestamp,
  updatedAt: Timestamp
}

// Collection: orders
{
  id: String, 
  orderNumber: String, 
  userId: String, // Optional for guest checkout
  guestEmail: String, // Optional for guest checkout
  guestName: String, // Optional for guest checkout
  guestPhone: String, // Optional for guest checkout
  
  // Shipping address
  shippingAddress: {
    street: String,
    city: String,
    state: String,
    postalCode: String,
    country: String
  },
  
  // Billing address
  billingAddress: {
    street: String,
    city: String,
    state: String,
    postalCode: String,
    country: String
  },
  
  // Order summary
  subtotal: Number,
  shippingCost: Number,
  taxAmount: Number,
  totalPrice: Number,
  
  // Order tracking
  orderDate: Timestamp,
  status: String, // "pending", "processing", "shipped", "delivered", "cancelled"
  statusHistory: [
    {
      status: String,
      timestamp: Timestamp,
      note: String
    }
  ],
  
  // Shipping info
  trackingNumber: String,
  shippingCarrier: String,
  estimatedDeliveryDate: Timestamp,
  
  // Items purchased
  items: [
    {
      productId: String,
      productName: String, // For historical record if product changes
      brandName: String,
      quantity: Number,
      pricePerUnit: Number,
      subtotal: Number
    }
  ],
  
  // Notes
  customerNotes: String,
  internalNotes: String,
  
  createdAt: Timestamp,
  updatedAt: Timestamp
}

// Collection: payments
{
  id: String, // Auto-generated by Firestore
  orderId: String, // Reference to orders collection
  userId: String, // Optional for guest checkout
  guestEmail: String, // Optional for guest checkout
  transactionId: String, // ID from payment processor
  amount: Number,
  currency: String, // e.g., "USD"
  paymentDate: Timestamp,
  method: String, // "credit_card", "paypal", "bank_transfer"
  status: String, // "pending", "completed", "failed", "refunded"
  gatewayResponse: Map, // Response from payment gateway
  createdAt: Timestamp,
  updatedAt: Timestamp
}

// Collection: shoppingCarts
{
  id: String, // Auto-generated by Firestore
  userId: String, // Optional for guest checkout
  sessionId: String, // For guest cart tracking
  items: [
    {
      productId: String,
      quantity: Number,
      addedAt: Timestamp
    }
  ],
  createdAt: Timestamp,
  updatedAt: Timestamp,
  expiresAt: Timestamp // For abandoned cart management
}

// Collection: inventory
{
  id: String, 
  productId: String,
  quantityAvailable: Number,
  lowStockThreshold: Number,
  lastRestocked: Timestamp,
  createdAt: Timestamp,
  updatedAt: Timestamp
}

// Collection: messages
{
  id: String, // Auto-generated by Firestore
  name: String, // Required: Sender's name
  email: String, // Required: Sender's email (if not logged in)
  userEmail: String, // Optional: Sender's email (could be from user account)
  userId: String, // Optional: Reference to users collection (null for guest)
  subject: String, // Required: Message subject
  message: String, // Required: Message content
  status: String, // Required: One of "new", "read", "responded"
  createdAt: Timestamp, // Required: When message was created
  updatedAt: Timestamp // Required: When message was last updated
}